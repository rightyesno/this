<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Checker</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { position: relative; }
        textarea, .highlightedText {
            width: 100%;
            height: 200px;
            padding: 10px;
            font-size: 16px;
            font-family: inherit;
            line-height: 1.5;
        }
        textarea { 
            position: absolute; 
            top: 0; 
            left: 0; 
            background: transparent; 
            z-index: 1; 
            color: transparent; 
            caret-color: black; /* Only caret visible */
        }
        .highlightedText {
            white-space: pre-wrap; /* Preserve whitespace and newlines */
            word-wrap: break-word; /* Ensure long words break */
            z-index: 0;
        }
        .highlight { background-color: yellow; }
        #results { margin-top: 20px; }
        #aiSuggestions { margin-top: 20px; font-style: italic; }
    </style>
</head>
<body>

<h1>Grammar Checker</h1>

<div class="container">
    <textarea id="textInput" placeholder="Type or paste your text here..." oninput="syncText()"></textarea>
    <div class="highlightedText" id="highlightedText"></div>
</div>
<br>
<button onclick="checkGrammar()">Check Text</button>

<div id="results"></div>
<div id="aiSuggestions"></div>

<script>
    // Sync the content of the textarea to the div for highlighting
    function syncText() {
        const text = document.getElementById("textInput").value;
        document.getElementById("highlightedText").textContent = text; // Initially without highlighting
    }

    function checkGrammar() {
        const text = document.getElementById("textInput").value;

        // Send a request to LanguageTool API
        fetch("https://api.languagetool.org/v2/check", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
            body: `text=${encodeURIComponent(text)}&language=en-US`,
        })
        .then(response => response.json())
        .then(data => {
            const highlightedTextDiv = document.getElementById("highlightedText");
            const resultsDiv = document.getElementById("results");
            const aiSuggestionsDiv = document.getElementById("aiSuggestions");

            let highlightedText = text;
            let offsetAdjustment = 0;

            resultsDiv.innerHTML = '';  // Clear previous results
            aiSuggestionsDiv.innerHTML = '';  // Clear previous suggestions

            if (data.matches.length === 0) {
                resultsDiv.innerHTML = "<p>No grammar, spelling, or punctuation issues found.</p>";
                syncText(); // No errors, sync plain text
            } else {
                // Process and highlight errors
                data.matches.forEach((match, index) => {
                    const start = match.offset + offsetAdjustment;
                    const end = start + match.length;
                    const errorSnippet = text.slice(match.offset, match.offset + match.length);

                    // Highlight the error in the text using a span
                    highlightedText = highlightedText.substring(0, start) + 
                                      `<span class="highlight">${highlightedText.substring(start, end)}</span>` + 
                                      highlightedText.substring(end);

                    // Adjust offset for added span tags
                    offsetAdjustment += `<span class="highlight"></span>`.length;

                    // Create a detailed issue display
                    const issue = document.createElement("p");
                    issue.innerHTML = `<strong>Issue ${index + 1}:</strong> ${match.message}<br>
                                       <strong>Error:</strong> "${errorSnippet}"<br>
                                       <strong>Position:</strong> Character ${match.offset} to ${match.offset + match.length}<br>
                                       <strong>Suggestion:</strong> ${match.replacements.map(r => r.value).join(", ")}`;
                    resultsDiv.appendChild(issue);
                });

                // Update the highlighted div with the highlighted errors
                highlightedTextDiv.innerHTML = highlightedText;

                // AI Suggestion: Improving style or rephrasing
                const smartSuggestion = generateSmartSuggestions(text, data.matches);
                aiSuggestionsDiv.innerHTML = `<strong>AI Suggestion:</strong> ${smartSuggestion}`;
            }
        })
        .catch(error => {
            console.error("Error:", error);
            document.getElementById("results").innerHTML = "<p>Error occurred while checking text.</p>";
        });
    }

    // AI-driven smart suggestions function
    function generateSmartSuggestions(text, matches) {
        const suggestionForPunctuation = matches.some(match => match.rule.issueType === "typographical");
        const suggestionForShortText = text.length < 20;

        if (suggestionForPunctuation) {
            return "Make sure your text has proper punctuation for clarity.";
        } else if (suggestionForShortText) {
            return "Try to expand on your ideas for more clarity.";
        } else {
            // More general style improvement suggestions
            const suggestions = [
                "Consider using more concise language.",
                "Try to simplify complex sentences.",
                "Use more active voice for a stronger tone.",
                "Ensure clarity by breaking long sentences into smaller ones."
            ];
            return suggestions[Math.floor(Math.random() * suggestions.length)];
        }
    }
</script>

</body>
</html>
